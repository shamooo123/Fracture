// --- THREE.JS 3D SETUP ---
        let camera, scene, renderer;
        let skeletonModel; 
        let wristBone = null; // We will store your Blender bone here

        function init3D() {
            const container = document.getElementById('scene-container');

            // 1. Scene & Camera
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x7f8c8d); 

            camera = new THREE.PerspectiveCamera(40, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 5, 12); 
            camera.lookAt(0, 0, 0);

            // 2. Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // 3. Lighting
            const dirLight = new THREE.DirectionalLight(0xffffff, 1);
            dirLight.position.set(5, 10, 7);
            scene.add(dirLight);
            scene.add(new THREE.AmbientLight(0x606060));

            // --- LOAD REALISTIC SKELETON MODEL ---
            const loader = new THREE.GLTFLoader();
            
            loader.load('arm_broken.glb', function(gltf) {
                skeletonModel = gltf.scene;
                skeletonModel.scale.set(1, 1, 1); 
                skeletonModel.position.set(0, 0, 0);
                scene.add(skeletonModel);

                // --- FIND YOUR INVISIBLE BONES ---
                let bones = [];
                skeletonModel.traverse(function(child) {
                    if (child.isBone) {
                        bones.push(child);
                    }
                });

                // Since you built a 2-bone chain, bone[0] is the stable forearm, 
                // and bone[1] is the hand that snaps!
                if (bones.length > 1) {
                    wristBone = bones[1]; 
                }

            }, undefined, function(error) {
                console.error('Error loading GLB model:', error);
            });

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function onWindowResize() {
            const container = document.getElementById('scene-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // --- SENSOR SIMULATION LOGIC ---
        let isSimulating = false;
        let intervalId;

        function updateSensors() {
            let temp = 36.5 + (Math.random() * 0.5);
            let pain = 10 + (Math.random() * 5);
            let pres = 15 + (Math.random() * 5);
            let angle = 0; 

            // Force Simulation
            if (isSimulating) {
                pain += 50;
                pres += 70;
                angle = 45; // Target bend angle in degrees
            } else {
                angle = 0; // Straight arm
            }

            if(pres > 100) pres = 100;
            if(pain > 100) pain = 100;

            document.getElementById('val-temp').innerText = temp.toFixed(1) + "Â°C";
            // ... Keep your existing bar width updates here ...

            // --- BEND THE BONE DIRECTLY ---
            if (wristBone) {
                // Three.js uses radians, so we convert your angle degrees to radians
                // Note: Depending on how the bone is rotated in Blender, you might need 
                // to change '.z' to '.x' or '.y' to get it to bend the right direction!
                wristBone.rotation.z = angle * (Math.PI / 180);
            }

            // 2D Hall Sensor Viz
            const hall = document.getElementById('hall-indicator');
            if(hall) hall.style.transform = `translateX(-50%) rotate(${angle}deg)`;
        }
